# 网络扫描器

一个基于Qt的综合性网络扫描工具，用于扫描局域网中的计算机，以可视化方式展示网络拓扑结构，并提供详细的设备分析。

## 主要功能

- 自动检测本地网络接口
- 扫描局域网内所有可达的计算机
- 显示主机IP地址、主机名、MAC地址和可连接状态
- 识别并显示设备的MAC地址厂商信息
- **直观的网络拓扑图可视化，显示网络设备之间的关系**
- **智能设备类型识别（路由器、服务器、PC、移动设备等）**
- **设备统计分析和图表展示（设备类型分布、厂商分布）**
- **开放端口分布统计和图表展示**
- **安全风险分析和安全报告生成**
- **扫描历史记录和会话比较功能**
- **支持明暗两种主题模式切换**
- 实时显示扫描进度和结果
- 支持多线程并行扫描，提高扫描速度
- 可配置自定义端口扫描列表
- 可设置扫描超时时间
- 可指定自定义IP地址范围
- 可保存和导出扫描结果
- 可查看主机的详细信息和开放端口
- 支持设置保存和加载
- **支持计划任务扫描**
- **过滤和搜索扫描结果**

## 构建要求

- Qt 6.0或更高版本（也兼容Qt 5）
- C++17标准支持
- CMake 3.16或更高版本
- 需要包含QtCharts模块（Qt5需要单独安装，Qt6已包含）

## 构建步骤

1. 确保已安装Qt和CMake
2. 克隆或下载此项目
3. 创建构建目录：`mkdir build && cd build`
4. 运行CMake生成构建文件：`cmake ..`
5. 编译项目：`make` 或 `cmake --build .`
6. 运行程序：`./NetScanner`

```bash
cd /NetworkScanner
rm -rf build
mkdir build && cd build
cmake ..
make -j8
./NetScanner
```

## 详细使用指南

### 基本扫描

1. 启动应用程序
2. 可选：在"扫描设置"标签页配置扫描参数
   - 可以设置自定义端口列表，格式为逗号分隔的端口号，例如：`21,22,23,80,443`
   - 可以设置连接超时时间（100-10000毫秒之间），默认为500毫秒
   - 可以设置自定义IP地址范围，例如从`192.168.1.1`到`192.168.1.254`
3. 返回"扫描结果"标签页，点击"开始扫描"按钮
4. 等待扫描完成（进度条显示当前扫描进度）
5. 查看结果表格中显示的主机信息，包括IP地址、主机名、MAC地址和厂商信息
6. 双击任一主机查看其详细信息，包括所有开放端口

### 网络拓扑

1. 完成扫描后，切换到"网络拓扑"标签页
2. 查看自动生成的网络拓扑图：
   - 中心节点通常是网关或路由器（红色图标）
   - 服务器显示为蓝色图标
   - 个人电脑显示为绿色图标
   - 移动设备显示为橙色图标
   - 打印机显示为紫色图标
   - 智能设备显示为青色图标
3. 使用"自动布局"按钮重新排列设备位置
4. 使用"+"和"-"按钮放大或缩小视图
5. 使用"重置视图"按钮恢复默认视图
6. 鼠标悬停在设备节点上可查看设备详细信息
7. 点击设备节点可选中该设备，并自动在"扫描结果"中突出显示
8. 通过"保存网络拓扑图"功能可导出当前拓扑图为PNG或JPG图像文件

### 设备分析

1. 完成扫描后，切换到"统计分析"标签页
2. 查看三种图表：
   - **设备类型分布**：饼图显示不同类型设备（路由器、服务器、PC、移动设备等）的数量和百分比
   - **厂商分布**：饼图显示不同厂商设备的数量和百分比，展示前5大厂商，其余归为"其他"
   - **端口分布**：柱状图显示常见端口（如21、22、80、443等）的开放情况
3. 点击"生成安全报告"按钮获取网络安全分析和建议，报告将包含：
   - 设备数量统计
   - 高风险开放端口清单（如21/FTP、22/SSH、23/Telnet等）
   - 每台设备的安全风险评估
   - 具体的安全加固建议

### 扫描历史

1. 每次完成扫描后，结果会自动保存到扫描历史
2. 在"扫描历史"标签页查看历史记录：
   - 从下拉列表中选择历史会话查看具体结果
   - 点击"加载会话"按钮可将历史结果加载到当前视图
   - 点击"删除会话"按钮可删除不需要的历史记录
3. 使用"比较会话"功能对比两次扫描结果：
   - 选择两个不同的扫描会话进行比较
   - 查看"新增主机"和"消失主机"两个标签页了解网络变化
   - 识别网络中的新设备或已移除设备
4. 通过"文件→保存扫描历史"菜单将历史记录保存到JSON文件中
5. 通过"文件→加载扫描历史"菜单从JSON文件加载历史记录

### 计划任务

1. 通过"工具→计划扫描"菜单设置定时扫描任务
2. 在弹出的对话框中：
   - 选择扫描的日期和时间
   - 设置是否使用当前扫描设置
   - 配置是否自动保存结果
   - 设置是否在扫描完成后显示通知
3. 点击确定后，系统将在指定时间自动执行扫描
4. 扫描结果将按照设置保存，并可选择性地显示通知

### 结果过滤

1. 使用扫描结果页面顶部的过滤工具栏筛选结果：
   - 按IP地址过滤（支持部分匹配）
   - 按厂商过滤（从下拉列表选择）
   - 按设备类型过滤（路由器、服务器、PC等）
2. 点击"应用过滤"按钮应用筛选条件
3. 点击"清除过滤"恢复显示所有结果

### 暗色模式

- 通过"视图→暗色模式"菜单项切换明暗主题
- 暗色模式下所有UI元素（包括图表）将采用深色背景，更适合夜间使用
- 设置将自动保存，下次启动时恢复上次的主题设置

## MAC地址厂商识别

应用程序内置了常见设备制造商的MAC地址前缀数据库，可以识别出许多设备的厂商，例如：
- 苹果 (Apple)
- 微软 (Microsoft)
- 华为 (Huawei)
- 思科 (Cisco)
- 小米 (Xiaomi)
- TP-Link
- 联想 (Lenovo)
- 华硕 (ASUS)
- VMware虚拟机
等多种设备。

程序支持多种格式的MAC地址解析，包括：
- 标准冒号分隔格式：`00:1A:2B:3C:4D:5E`
- 连字符分隔格式：`00-1A-2B-3C-4D-5E`
- 不规则格式：例如某些系统输出的单个字符格式，如`0:1A:2B:3:4D:5E`

## 安全报告功能

可自动检测网络中的高风险开放端口，包括：
- FTP (21): 文件传输协议，明文传输凭据
- SSH (22): 远程管理端口
- Telnet (23): 未加密的远程管理
- SMTP (25): 邮件服务
- DNS (53): 域名服务
- HTTP (80): 网页服务
- RDP (3389): 远程桌面协议
- SMB (445): 文件共享服务

安全报告会提供具体的安全建议，帮助加强网络安全：
1. 限制远程管理端口(22, 23, 3389)的访问范围
2. 禁用未加密的服务(如Telnet, FTP)
3. 对必要的服务设置强密码和访问控制
4. 及时更新系统和应用补丁
5. 对重要设备设置防火墙规则

## 故障排除

### 常见问题

1. **无法检测到网络接口**
   - 确保用户有足够的权限访问网络接口
   - 在某些系统上，可能需要管理员/root权限运行程序

2. **扫描结果中MAC地址显示"未知"**
   - 确保系统上有ARP命令可用
   - 在macOS/Linux上，程序默认使用`/usr/sbin/arp`
   - 在Windows上，程序使用系统`arp`命令

3. **扫描速度慢**
   - 尝试减少要扫描的端口数量
   - 减小超时设置值（默认为500毫秒）
   - 请注意，设置过小的超时值可能导致漏检主机

4. **某些设备没有被检测到**
   - 某些设备可能配置了防火墙阻止ICMP和常见端口
   - 尝试增加超时设置值
   - 考虑在扫描设置中添加设备可能开放的特定端口

5. **拓扑图不显示某些设备之间的连接**
   - 当前版本使用简化的拓扑推断算法
   - 所有设备默认连接到检测到的路由器/网关

### 性能优化

- 扫描大型网络（超过254个地址）时，建议使用自定义IP范围，分段扫描
- 在配置较低的计算机上，可以减少扫描的端口数量以提高速度
- 禁用"自动保存结果"可减少内存占用

## 开发注意事项

### QtCharts命名空间
此项目使用QtCharts库进行数据可视化，需要注意：

1. 在CMakeLists.txt中，我们使用 `-DQT_CHARTS_USE_NAMESPACE` 宏定义来简化命名空间的使用
2. 如果您直接在代码中使用 `using namespace QtCharts;`，在某些Qt版本中可能导致编译错误
3. 当使用QtCharts类时，推荐以下两种方式之一：
   - 使用完整命名空间：`QtCharts::QChart`
   - 在CMakeLists.txt中添加全局宏定义：`add_definitions(-DQT_CHARTS_USE_NAMESPACE)`

### 内存管理和界面初始化
为确保程序稳定性：

1. 确保所有QWidget对象都有正确的父子关系，避免浮动窗口
2. 在MainWindow构造函数中，先创建UI组件，再创建功能对象（如扫描器、分析器等）
3. 信号槽连接前，确保对应的对象已正确初始化
4. 图表组件的创建和使用需要特别注意其生命周期管理

## 版本历史

### v2.1.0 
- 修复了MAC地址解析问题，增强了对不规则MAC地址格式的支持
- 实现了网络拓扑图的缩放和重置功能
- 优化了设备类型识别算法
- 改进了主窗口组件初始化顺序，提高程序稳定性

### v2.0.0 
- 添加了网络拓扑可视化功能
- 添加了设备类型识别功能
- 添加了扫描历史和会话比较功能
- 添加了统计分析和图表展示功能
- 添加了安全报告生成功能
- 添加了计划任务扫描功能
- 添加了结果过滤功能
- 添加了暗色模式

### v1.0.0 
- 初始版本
- 基本网络扫描功能
- 显示主机IP、主机名和MAC地址
- 支持端口扫描
- 支持MAC厂商识别


项目GitHub：https://github.com/Dictatora0/NetworkScanner.git
