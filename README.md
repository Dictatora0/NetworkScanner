# 网络扫描器

一个基于Qt的综合性网络扫描工具，用于扫描局域网中的计算机，以可视化方式展示网络拓扑结构，并提供详细的设备分析。

## 功能

- 自动检测本地网络接口
- 扫描局域网内所有可达的计算机
- 显示主机IP地址、主机名、MAC地址和可连接状态
- 识别并显示设备的MAC地址厂商信息
- **直观的网络拓扑图可视化，显示网络设备之间的关系**
- **智能设备类型识别（路由器、服务器、PC、移动设备等）**
- **设备统计分析和图表展示（设备类型分布、厂商分布）**
- **开放端口分布统计和图表展示**
- **安全风险分析和安全报告生成**
- **扫描历史记录和会话比较功能**
- **支持明暗两种主题模式切换**
- 实时显示扫描进度和结果
- 支持多线程并行扫描，提高扫描速度
- 可配置自定义端口扫描列表
- 可设置扫描超时时间
- 可指定自定义IP地址范围
- 可保存和导出扫描结果
- 可查看主机的详细信息和开放端口
- 支持设置保存和加载
- **支持计划任务扫描**
- **过滤和搜索扫描结果**

## 构建要求

- Qt 6.0或更高版本（也兼容Qt 5）
- C++17标准支持
- CMake 3.16或更高版本
- 需要包含QtCharts模块（Qt5需要单独安装，Qt6已包含）

## 构建步骤

1. 确保已安装Qt和CMake
2. 克隆或下载此项目
3. 创建构建目录：`mkdir build && cd build`
4. 运行CMake生成构建文件：`cmake ..`
5. 编译项目：`make` 或 `cmake --build .`
6. 运行程序：`./NetScanner`

```bash
cd build
cmake ..
make
./NetScanner
```

## 使用方法

### 基本扫描

1. 启动应用程序
2. 可选：在"扫描设置"标签页配置扫描参数
   - 可以设置自定义端口列表
   - 可以设置连接超时时间
   - 可以设置自定义IP地址范围
3. 返回"扫描结果"标签页，点击"开始扫描"按钮
4. 等待扫描完成（进度条显示当前扫描进度）
5. 查看结果表格中显示的主机信息，包括IP地址、主机名、MAC地址和厂商信息
6. 双击任一主机查看其详细信息

### 网络拓扑

1. 完成扫描后，切换到"网络拓扑"标签页
2. 查看自动生成的网络拓扑图，中心节点通常是网关或路由器
3. 使用"自动布局"按钮重新排列设备位置
4. 使用"+"和"-"按钮放大或缩小视图
5. 将鼠标悬停在设备节点上可查看设备详细信息
6. 通过"保存网络拓扑图"功能可导出当前拓扑图为图像文件

### 设备分析

1. 完成扫描后，切换到"统计分析"标签页
2. 查看设备类型分布、厂商分布、端口分布的图表
3. 点击"生成安全报告"按钮获取网络安全分析和建议

### 历史记录

1. 每次完成扫描后，结果会自动保存到扫描历史
2. 在"扫描历史"标签页选择历史会话查看过去的扫描结果
3. 使用"比较会话"功能比较两次扫描结果，查看网络变化
4. 可通过"文件→保存扫描历史"菜单将历史记录保存到文件中

### 其他功能

- **计划扫描**：通过"工具→计划扫描"设置定时扫描任务
- **暗色模式**：通过"视图→暗色模式"切换界面主题
- **结果过滤**：使用过滤器按IP、厂商或设备类型筛选结果
- **导出结果**：通过"文件→导出结果"将扫描结果保存为CSV文件

## MAC地址厂商识别

应用程序内置了常见设备制造商的MAC地址前缀数据库，可以识别出许多设备的厂商，例如：
- 苹果
- 微软
- 华为
- 思科
- 小米
- TP-Link
- 联想
- 华硕
- VMware虚拟机
等多种设备。

## 安全报告功能

可自动检测网络中的高风险开放端口，包括：
- FTP (21): 文件传输协议，明文传输凭据
- SSH (22): 远程管理端口
- Telnet (23): 未加密的远程管理
- RDP (3389): 远程桌面协议
- SMB (445): 文件共享服务

安全报告会提供具体的安全建议，帮助加强网络安全。

## 开发注意事项

### QtCharts命名空间
此项目使用QtCharts库进行数据可视化，需要注意：

1. 在CMakeLists.txt中，我们使用 `-DQT_CHARTS_USE_NAMESPACE` 宏定义来简化命名空间的使用
2. 如果您直接在代码中使用 `using namespace QtCharts;`，在某些Qt版本中可能导致编译错误
3. 当使用QtCharts类时，推荐以下两种方式之一：
   - 使用完整命名空间：`QtCharts::QChart`
   - 在CMakeLists.txt中添加全局宏定义：`add_definitions(-DQT_CHARTS_USE_NAMESPACE)`

### 内存管理和界面初始化
为确保程序稳定性：

1. 确保所有QWidget对象都有正确的父子关系，避免浮动窗口
2. 在MainWindow构造函数中，先创建UI组件，再创建功能对象（如扫描器、分析器等）
3. 信号槽连接前，确保对应的对象已正确初始化
4. 图表组件的创建和使用需要特别注意其生命周期管理

## 最近更新

### 2024年5月更新
- 修复了与QtCharts命名空间相关的编译错误
- 优化了MainWindow中组件初始化顺序，提高程序稳定性
- 改进了图表初始化和更新逻辑，避免空指针异常
- 增强了信号槽连接的安全性，添加了空指针检查
- 重构了统计和拓扑标签页的布局，提升视觉体验
- 添加了对各种控件的父子关系检查，防止内存泄漏

## 注意事项

- 应用程序会通过尝试连接常见端口来判断主机是否可达
- 扫描过程可能会被某些防火墙拦截
- 扫描大型网络可能需要较长时间
- MAC地址获取功能需要系统上有arp命令支持(macOS/Linux上已指定/usr/sbin/arp路径)
- 网络拓扑和设备类型识别基于启发式算法，准确性取决于可获取的信息 